; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
; ==============================================================
; BaseApp for Kode Dot (ESP32‑S3)
; Builds Arduino firmware and flashes app only (keeps bootloader/partitions).
; ==============================================================
[platformio]
; Default environment
default_envs = kode_dot

[env:kode_dot]
; Kode Dot target (ESP32‑S3)
; ESP32 platform (pinned stable)
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
; Board id (see boards/kode_dot.json)
board = kode_dot
framework = arduino
lib_compat_mode = off
monitor_speed = 115200
lib_ldf_mode = chain
; Serial monitor filters
monitor_filters = time, esp32_exception_decoder
; Build flags
build_flags = 
    ; Add include path for src
    -I src
    ; Wrap OTA validation/rollback
    -Wl,--wrap=esp_ota_mark_app_valid_cancel_rollback
    ; Enable LVGL simple include
    -DLV_CONF_INCLUDE_SIMPLE
    ; Suppress deprecation warnings
    -Wno-deprecated-declarations
    ; Allow #warning without failing build
    -Wno-cpp
app_name = CuteAssistant
; Pre-build scripts
extra_scripts = pre:extra_scripts/auto_port.py, pre:extra_scripts/rename_bin.py
upload_protocol = custom
upload_port = auto
monitor_port = auto
upload_speed = 460800
; Flash app at 0x400000 (preserve bootloader/partitions)
; Use modern esptool syntax (no .py; flags with dashes)
upload_command = esptool --chip esp32s3 --port ${UPLOAD_PORT} --baud ${UPLOAD_SPEED} write-flash --flash-freq 80m --flash-mode dio --flash-size 32MB 0x400000 ${BUILD_DIR}/${PROGNAME}.bin

; Libraries
lib_deps =
  adafruit/Adafruit BusIO @ ^1.15.0
  adafruit/Adafruit Unified Sensor @ ^1.1.4
  moononournation/GFX Library for Arduino @ ^1.6.0
  lvgl/lvgl @ ^9.0.0
  adafruit/Adafruit NeoPixel
  Makuna/NeoPixelBus @ ^2.7.7
  https://github.com/RobTillaart/TCA9555.git#0.4.3
  https://github.com/bitbank2/bb_captouch.git
  adafruit/Adafruit LIS2MDL
  adafruit/Adafruit LSM6DS
  https://github.com/kodediy/kode_MAX31329.git
  https://github.com/sqmsmu/PMIC_BQ25896.git
  https://github.com/kodediy/kode_BQ27220.git
  madhephaestus/ESP32Servo @ ^3.0.5
  bblanchon/ArduinoJson @ ^7.0.0
  densaugeo/base64 @ ^1.4.0

[env:cardputer]
extends = kode_dot
board = cardputer
build_flags =
    ${env:kode_dot.build_flags}
    -DCARDPUTER_TARGET
lib_deps =
    ${env:kode_dot.lib_deps}
    m5stack/M5Unified @ ^0.1.16

[env:cores3_lite]
extends = kode_dot
board = cores3_lite
build_flags =
    ${env:kode_dot.build_flags}
    -DCORES3_LITE_TARGET
lib_deps =
    ${env:kode_dot.lib_deps}
    m5stack/M5Unified @ ^0.1.16
